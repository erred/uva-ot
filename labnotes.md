grep 1433 snort3-community.rules | sed -e 's/\$\(HOME_NET\|EXTERNAL_NET\|SQL_SERVERS\)/any/g' > local.rules

sqlcmd -S 145.100.111.82 -U 'ot-lab' -P 'zaza6password'
SELECT table_name FROM information_schema.tables;
go

alert http ( msg:"HTTP login error"; file_data; content:"Unable to connect";sid:100001; )

{ "seconds" : 1585846483, "action" : "allow", "class" : "none", "b64_data" : "PCFkb2N0eXBlIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KCjxoZWFkPgogICAgPG1ldGEgY2hhcnNldD0idXRmOCI+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLGluaXRpYWwtc2NhbGU9MS4wIj4KCiAgICA8dGl0bGU+T1QgTGFiPC90aXRsZT4KICAgIDxsaW5rIHJlbD0ic3R5bGVzaGVldCIgaHJlZj0iL2luZGV4LmNzcyI+CjwvaGVhZD4KCjxib2R5PgogICAgPHByZSBzdHlsZT0iY29sb3I6IG9yYW5nZXJlZCI+VW5hYmxlIHRvIGNvbm5lY3QgdG8gZGF0YWJhc2UhPC9wcmU+CgogICAgPGJyPgoKICAgIDxmb3JtIGFjdGlvbj0iaW5kZXgucGhwIiBtZXRob2Q9IlBPU1QiPgogICAgICAgIDxsYWJlbCBmb3I9InVzZXJuYW1lIj5Vc2VybmFtZTwvbGFiZWw+CiAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIGlkPSJ1c2VybmFtZSIgbmFtZT0idXNlcm5hbWUiIHZhbHVlPSJvdC1sYWJiIj4KCiAgICAgICAgPGxhYmVsIGZvcj0icGFzc3dvcmQiPlBhc3N3b3JkPC9sYWJlbD4KICAgICAgICA8aW5wdXQgdHlwZT0icGFzc3dvcmQiIGlkPSJwYXNzd29yZCIgbmFtZT0icGFzc3dvcmQiIHZhbHVlPSJ6YXphNnBhc3N3b3JkIj4KCiAgICAgICAgPGJyPjxicj4KCiAgICAgICAgPGlucHV0IHR5cGU9InN1Ym1pdCIgaWQ9InN1Ym1pdCIgdmFsdWU9IkxvZ2luIj4KICAgIDwvZm9ybT4KPC9ib2R5PgoKPC9odG1sPg==", "dir" : "S2C", "dst_addr" : "213.124.209.222", "dst_ap" : "213.124.209.222:39200", "dst_port" : 39200, "gid" : 1, "iface" : "xenbr0", "msg" : "HTTP login error", "mpls" : 0, "pkt_gen" : "stream_tcp", "pkt_len" : 712, "pkt_num" : 121, "priority" : 0, "proto" : "TCP", "rev" : 0, "rule" : "1:100001:0", "service" : "http", "sid" : 100001, "src_addr" : "145.100.111.82", "src_ap" : "145.100.111.82:80", "src_port" : 80, "vlan" : 0, "timestamp" : "04/02-18:54:43.025386" }

alert http ( msg:"HTTP login success"; file_data; content:"Microsoft SQL Server";sid:100002; )

{ "seconds" : 1585846488, "action" : "allow", "class" : "none", "b64_data" : "PCFkb2N0eXBlIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KCjxoZWFkPgogICAgPG1ldGEgY2hhcnNldD0idXRmOCI+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLGluaXRpYWwtc2NhbGU9MS4wIj4KCiAgICA8dGl0bGU+T1QgTGFiPC90aXRsZT4KICAgIDxsaW5rIHJlbD0ic3R5bGVzaGVldCIgaHJlZj0iL2luZGV4LmNzcyI+CjwvaGVhZD4KCjxib2R5PgogICAgPHByZSBzdHlsZT0iY29sb3I6IGdyZWVueWVsbG93Ij5NaWNyb3NvZnQgU1FMIFNlcnZlciAyMDEyIC0gMTEuMC4yMTAwLjYwIChYNjQpIAoJRmViIDEwIDIwMTIgMTk6Mzk6MTUgCglDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbgoJRXhwcmVzcyBFZGl0aW9uICg2NC1iaXQpIG9uIFdpbmRvd3MgTlQgNi4xIDxYNjQ+IChCdWlsZCA3NjAxOiBTZXJ2aWNlIFBhY2sgMSkgKEh5cGVydmlzb3IpCjwvcHJlPgoKICAgIDxicj4KCiAgICA8Zm9ybSBhY3Rpb249ImluZGV4LnBocCIgbWV0aG9kPSJQT1NUIj4KICAgICAgICA8bGFiZWwgZm9yPSJ1c2VybmFtZSI+VXNlcm5hbWU8L2xhYmVsPgogICAgICAgIDxpbnB1dCB0eXBlPSJ0ZXh0IiBpZD0idXNlcm5hbWUiIG5hbWU9InVzZXJuYW1lIiB2YWx1ZT0ib3QtbGFiIj4KCiAgICAgICAgPGxhYmVsIGZvcj0icGFzc3dvcmQiPlBhc3N3b3JkPC9sYWJlbD4KICAgICAgICA8aW5wdXQgdHlwZT0icGFzc3dvcmQiIGlkPSJwYXNzd29yZCIgbmFtZT0icGFzc3dvcmQiIHZhbHVlPSJ6YXphNnBhc3N3b3JkIj4KCiAgICAgICAgPGJyPjxicj4KCiAgICAgICAgPGlucHV0IHR5cGU9InN1Ym1pdCIgaWQ9InN1Ym1pdCIgdmFsdWU9IkxvZ2luIj4KICAgIDwvZm9ybT4KPC9ib2R5PgoKPC9odG1sPg==", "dir" : "S2C", "dst_addr" : "213.124.209.222", "dst_ap" : "213.124.209.222:39200", "dst_port" : 39200, "gid" : 1, "iface" : "xenbr0", "msg" : "HTTP login success", "mpls" : 0, "pkt_gen" : "stream_tcp", "pkt_len" : 883, "pkt_num" : 398, "priority" : 0, "proto" : "TCP", "rev" : 0, "rule" : "1:100002:0", "service" : "http", "sid" : 100002, "src_addr" : "145.100.111.82", "src_ap" : "145.100.111.82:80", "src_port" : 80, "vlan" : 0, "timestamp" : "04/02-18:54:48.608504" }

alert tcp 145.100.111.82 1433 <> 145.100.111.81 any (msg:"MSSQL request"; flow:established,to_server; sid:100003; )

{ "seconds" : 1585846812, "action" : "allow", "class" : "none", "b64*data" : "AQEAggAAAQAWAAAAEgAAAAIAAAAAAAAAAAABAAAAUwBFAEwARQBDAFQAIAB0AGEAYgBsAGUAXwBuAGEAbQBlACAARgBSAE8ATQAgAGkAbgBmAG8AcgBtAGEAdABpAG8AbgBfAHMAYwBoAGUAbQBhAC4AdABhAGIAbABlAHMAOwAKAA==", "dir" : "C2S", "dst_addr" : "145.100.111.82", "dst_ap" : "145.100.111.82:1433", "dst_port" : 1433, "eth_dst" : "00:16:3E:12:88:0E", "eth_len" : 196, "eth_src" : "B6:C9:02:58:4E:50", "eth_type" : "0x800", "gid" : 1, "iface" : "xenbr0", "ip_id" : 20796, "ip_len" : 162, "msg" : "MSSQL request", "mpls" : 0, "pkt_gen" : "raw", "pkt_len" : 182, "pkt_num" : 3708, "priority" : 0, "proto" : "TCP", "rev" : 0, "rule" : "1:100003:0", "service" : "unknown", "sid" : 100003, "src_addr" : "145.100.111.81", "src_ap" : "145.100.111.81:32875", "src_port" : 32875, "tcp_ack" : 2849080539, "tcp_flags" : "\*\*\_AP*\*\*", "tcp_len" : 32, "tcp_seq" : 3226093598, "tcp_win" : 501, "tos" : 0, "ttl" : 64, "vlan" : 0, "timestamp" : "04/02-19:00:12.060321" }

alert tcp 145.100.111.82 1433 <> 145.100.111.81 any (msg:"MSSQL response"; flow:established,to_client; sid:100004; )

{ "seconds" : 1585846812, "action" : "allow", "class" : "none", "b64*data" : "BAEA/wAzAQCBAQAAAQAACADnAAEJBNAANAp0AGEAYgBsAGUAXwBuAGEAbQBlANEeAHMAcAB0AF8AZgBhAGwAbABiAGEAYwBrAF8AZABiANEgAHMAcAB0AF8AZgBhAGwAbABiAGEAYwBrAF8AZABlAHYA0SAAcwBwAHQAXwBmAGEAbABsAGIAYQBjAGsAXwB1AHMAZwDRFABzAHAAdABfAHYAYQBsAHUAZQBzANEWAHMAcAB0AF8AbQBvAG4AaQB0AG8AcgDRKgBNAFMAcgBlAHAAbABpAGMAYQB0AGkAbwBuAF8AbwBwAHQAaQBvAG4AcwD9EADBAAYAAAAAAAAA", "dir" : "S2C", "dst_addr" : "145.100.111.81", "dst_ap" : "145.100.111.81:32875", "dst_port" : 32875, "eth_dst" : "B6:C9:02:58:4E:50", "eth_len" : 321, "eth_src" : "00:16:3E:12:88:0E", "eth_type" : "0x800", "gid" : 1, "iface" : "xenbr0", "ip_id" : 14015, "ip_len" : 287, "msg" : "MSSQL response", "mpls" : 0, "pkt_gen" : "raw", "pkt_len" : 307, "pkt_num" : 3709, "priority" : 0, "proto" : "TCP", "rev" : 0, "rule" : "1:100004:0", "service" : "unknown", "sid" : 100004, "src_addr" : "145.100.111.82", "src_ap" : "145.100.111.82:1433", "src_port" : 1433, "tcp_ack" : 3226093728, "tcp_flags" : "\*\*\_AP*\*\*", "tcp_len" : 32, "tcp_seq" : 2849080539, "tcp_win" : 256, "tos" : 0, "ttl" : 128, "vlan" : 0, "timestamp" : "04/02-19:00:12.063914" }
